@using GovUkDesignSystem
@using GovUkDesignSystem.GovUkDesignSystemComponents
@using System.Globalization

@model SeaPublicWebsite.Models.EnergyEfficiency.ConfirmAddressViewModel
@{
    ViewBag.Title = "Confirm your address";
}

@section BeforeMain {
    @await Html.GovUkBackLink(new BackLinkViewModel
    {
        Text = "Back",
        Href = Model.BackLink,

        // Note: some of the "Back" links in this journey can't use the default browser behaviour
        //  so we should control all of them explicitly
        OverrideWithJavascript = false
    })
}

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
        @if (!Model.EpcInformationList.Any())
        {
            <h1 class="govuk-heading-l">
                @* changed "an" => "a complete" to cover the case that an epc is found but doesn't contain both property type and age built, hence is not shown to the user for confirmation*@
                We weren't able to find a complete Energy Performance Certificate for your property
            </h1>

            <p class="govuk-body">
                We will need to ask you some questions to work out which of the available energy efficiency measures are most likely to be helpful to you.
            </p>

            @await Html.GovUkButton(new ButtonViewModel
            {
                Href = Url.Action("PropertyType_Get", "EnergyEfficiency", new { reference = Model.Reference}),
                Text = "Continue"
            })
        }
        else
        {
            <form action="@Url.Action("ConfirmAddress_Post", "EnergyEfficiency", new { reference = Model.Reference, epcCount = Model.EpcInformationList.Count })" method="post" novalidate>

                @Html.AntiForgeryToken()
                @if (Model.EpcInformationList.Count == 1)
                {
                    @Html.HiddenFor(m => m.SelectedEpcId)
                    <text>
                        <p class="govuk-caption-l">
                            Find your EPC
                        </p>

                        <h1 class="govuk-heading-l">
                            We found an Energy Performance Certificate that might be yours
                        </h1>

                        <p class="govuk-body">
                            This certificate may be registered to your property or one of the properties nearby that shares part of your address.
                        </p>
                    </text>

                    @await Html.GovUkNotificationBanner(new NotificationBannerViewModel
                    {
                        Type = "null",
                        TitleHtml = @<text>
                                        <div>Certificate</div>
                                     </text>,
                        Html = @<text>
                                   <div class="govuk-!-font-weight-bold">Registered address</div>
                                   @(Model.EpcInformationList[0].Address1)<br/>
                                   @if (!string.IsNullOrWhiteSpace(Model.EpcInformationList[0].Address2))
                                   {
                                       @(Model.EpcInformationList[0].Address2)
                                       <br/>
                                   }
                                   @(Model.EpcInformationList[0].Postcode)
                                </text>,
                    })
                    @(await Html.GovUkRadiosFor(m => m.SingleAddressConfirmed,
                        fieldsetOptions: new FieldsetViewModel
                        {
                            Legend = new LegendViewModel
                            {
                                Text = "Is this your address?",
                                Classes = "govuk-fieldset__legend--m",
                                IsPageHeading = false
                            }
                        }))
                }
                else
                {
                    <p class="govuk-caption-l">
                        Find your EPC
                    </p>

                    @await Html.GovUkRadiosFromStringsFor(m => m.SelectedEpcId,
                        radioOptions: Model.EpcOptionsWithUnlistedOption(),
                        fieldsetOptions: new FieldsetViewModel
                        {
                            Legend = new LegendViewModel
                            {
                                Text = "We found multiple Energy Performance Certificates that might be yours",
                                Classes = "govuk-fieldset__legend--l",
                                IsPageHeading = true
                            }
                        },
                        new HintViewModel
                        {
                            Html = @<text>
                                       <p class="govuk-body">
                                           One of these certificates may be registered to your property or to the properties nearby that share part of your address.
                                       </p>
                                       <p class="govuk-body">
                                           Your address may not be listed here if it does not have a registered certificate.
                                       </p>
                                       <p class="govuk-heading-m">
                                           Choose your address
                                       </p>
                                       <p class="govuk-hint">
                                           Please choose your address if it is listed, otherwise choose ‘My address is not listed here’
                                       </p>
                                    </text>
                        },
                        conditionalOptions: new Dictionary<string, Conditional>
                        {
                            {
                                "unlisted",
                                new Conditional
                                {
                                    Html = (@<text>
                                                <p class="govuk-hint">You can still continue to use this service as there are further questions that can help determine the kind of measures you can take.</p>
                                             </text>)
                                }
                            }
                        }
                        )
                }

                <div class="govuk-button-group">
                    @(await Html.GovUkButton(new ButtonViewModel
                    {
                        Text = "Continue",
                    }))
                </div>

            </form>
        }
    </div>
</div>